{% extends 'base.html.twig' %}

{% block title %}Ma commande : Zone-Frais{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 80%;">
    <h1>Ma commande {{ order.reference }}</h1>
    <a href="{{ path('account_order') }}">‚Üê Retour</a>

    {# üßæ Boutons PDF - petits et espac√©s #}
    <div class="d-flex mt-3 mb-3">
        <a href="{{ path('account_order_invoice_web', { reference: order.reference }) }}"
        class="btn btn-secondary btn-sm w-auto"
        target="_blank"
        style="margin-right: 10px;">
        Voir la facture
        </a>

        <a href="{{ path('account_order_invoice', { reference: order.reference }) }}?download=1"
        class="btn btn-primary btn-sm w-auto">
        T√©l√©charger la facture (PDF)
        </a>
    </div>

    <hr>

    <strong>Statut de la commande :</strong>
    <td>
        {% if order.paymentState == 1 and order.deliveryState == 0 %}
            Paiement accept√© / Commande valid√©e
        {% elseif order.deliveryState == 1 %}
            Pr√©paration en cours
        {% elseif order.deliveryState == 2 %}
            Livraison en cours
        {% elseif order.deliveryState == 3 %}
            Livraison termin√©e
        {% else %}
            Commande en attente
        {% endif %}
    </td><br>

    <strong>Commande pass√©e le :</strong> {{ order.createdAt|date('d/m/Y') }}<br>
    <strong>R√©f√©rence de ma commande :</strong> <small>{{ order.reference }}</small><br>
    <hr>

    <strong>D√©tails :</strong>

    <table class="table table-striped mt-4">
        <thead class="thead-dark">
            <tr>
                <th>Produit</th>
                <th>Quantit√©</th>
                <th>Poids</th>
                <th>Prix unitaire HT / Total HT</th>
            </tr>
        </thead>
        <tbody>
            {% set totalHT = 0 %}
            {% for item in order.orderDetails %}
                {% set totalItemHT = item.price * item.quantity %}
                <tr>
                    <td>{{ item.product }}</td>
                    <td>x{{ item.quantity }}</td>
                    <td>{{ item.weight * item.quantity }} kg</td>
                    <td>{{ (item.price / 100)|number_format(2, ',', '.') }} ‚Ç¨ / {{ (totalItemHT / 100)|number_format(2, ',', '.') }} ‚Ç¨</td>
                </tr>
                {% set totalHT = totalHT + totalItemHT %}
            {% endfor %}
        </tbody>
    </table>

    {# TVA et total TTC #}
    {% set tvaRate = 0.20 %}
    {% set tvaAmount = totalHT * tvaRate %}
    {% set totalTTC = (totalHT + tvaAmount + order.carrierPrice * 100) / 100 %}

    <div class="text-end" style="margin-right:30px;">
        <strong>Sous-total HT :</strong> {{ (totalHT / 100)|number_format(2, ',', '.') }} ‚Ç¨<br>
        <strong>TVA (20%) :</strong> {{ (tvaAmount / 100)|number_format(2, ',', '.') }} ‚Ç¨<br>
        <strong>Frais de livraison :</strong> {{ (order.carrierPrice)|number_format(2, ',', '.') }} ‚Ç¨<br>
        <strong>Total TTC :</strong> {{ totalTTC|number_format(2, ',', '.') }} ‚Ç¨<br>
    </div>
</div>
{% endblock %}
